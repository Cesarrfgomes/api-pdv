CREATE TABLE TABVENDEDOR (
       CODVENDEDOR NUMBER PRIMARY KEY,
       NOME VARCHAR(150) NOT NULL,
       EMAIL VARCHAR(150) NOT NULL
);

CREATE SEQUENCE TABVENDEDOR_SEQ START WITH 1 INCREMENT BY 1;

CREATE TRIGGER TK_VENDEDOR_CODVENDEDOR
BEFORE INSERT ON TABVENDEDOR
FOR EACH ROW
  BEGIN
    IF :NEW.CODVENDEDOR IS NULL THEN
        SELECT TABVENDEDOR_SEQ.NEXTVAL INTO :NEW.CODVENDEDOR FROM DUAL;
    END IF;
  END;
/

CREATE TABLE TABUSUARIO (
       CODUSUR NUMBER PRIMARY KEY,
       NOME VARCHAR(150) NOT NULL,
       EMAIL VARCHAR(150) UNIQUE NOT NULL,
       USUARIO VARCHAR(50) UNIQUE NOT NULL,
       SENHA VARCHAR(200) NOT NULL,
       CPF VARCHAR(14) UNIQUE,
       TIPOFUNC VARCHAR(2) CHECK (TIPOFUNC IN ('M', 'F', 'V')),
       CODVENDEDOR NUMBER DEFAULT NULL,
       
       CONSTRAINT FK_CODVENDEDOR FOREIGN KEY (CODVENDEDOR) REFERENCES TABVENDEDOR(CODVENDEDOR) 
);

COMMENT ON COLUMN TABUSUARIO.TIPOFUNC IS 'M - MOTORISTA; F - FUNCIONARIO; V - VENDEDOR';

CREATE SEQUENCE TABUSUARIO_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER TK_USUARIO_CODUSUR
BEFORE INSERT ON TABUSUARIO
FOR EACH ROW
  BEGIN
    IF :NEW.CODUSUR IS NULL THEN
      SELECT TABUSUARIO_SEQ.NEXTVAL INTO :NEW.CODUSUR FROM DUAL;
    END IF; 
  END;
/

CREATE TABLE TABCLIENTE (
    CODCLI NUMBER PRIMARY KEY,
    CODVENDEDOR NUMBER NOT NULL,
    NOME VARCHAR2(150) NOT NULL,
    BLOQUEIO VARCHAR2(10) CHECK (BLOQUEIO IN ('S', 'N')),
    EMAIL VARCHAR2(150) UNIQUE,
    CGCENT VARCHAR(18) UNIQUE NOT NULL,
    
    FOREIGN KEY (CODVENDEDOR) REFERENCES TABVENDEDOR(CODVENDEDOR)
);

COMMENT ON COLUMN TABCLIENTE.BLOQUEIO IS 'S - SIM; N -NÃO';

COMMENT ON COLUMN TABCLIENTE.CGCENT IS 'CPF OU CNPJ';

CREATE SEQUENCE TABCLIENTE_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER TK_CLIENTE_CODCLI
BEFORE INSERT ON TABCLIENTE
FOR EACH ROW
BEGIN
    IF :NEW.CODCLI IS NULL THEN
        SELECT TABCLIENTE_SEQ.NEXTVAL INTO :NEW.CODCLI FROM dual;
    END IF;
END;
/

CREATE TABLE TABCARGA (
       NUMCAR NUMBER PRIMARY KEY,
       CODUSUR NUMBER NOT NULL,
       DTSAIDA TIMESTAMP NOT NULL,
       DTFECHA TIMESTAMP NOT NULL,
       TOTPESO BINARY_DOUBLE DEFAULT NULL,
       
       FOREIGN KEY (CODUSUR) REFERENCES TABUSUARIO(CODUSUR)
);

CREATE SEQUENCE TABCARGA_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER TK_CARGA_NUMCAR
BEFORE INSERT ON TABCARGA
FOR EACH ROW
  BEGIN
    IF :NEW.NUMCAR IS NULL THEN
      SELECT TaBCARGA_SEQ.NEXTVAL INTO :NEW.NUMCAR FROM DUAL;
    END IF;
  END;
/

CREATE TABLE TABPRODUTO (
       CODPROD NUMBER PRIMARY KEY,
       DESCRICAO VARCHAR(250) NOT NULL,
       CODBARRAS VARCHAR(14)
);

CREATE SEQUENCE TABPRODUTO_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER TK_PRODUTO_CODPRO
BEFORE INSERT ON TABPRODUTO
FOR EACH ROW
  BEGIN
    IF :NEW.CODPROD IS NULL THEN
      SELECT TBPRODUTO_SEQ.NEXTVAL INTO :NEW.CODPROD FROM DUAL;
    END IF;   
  END;
/

CREATE TABLE TBEST (
       CODPROD NUMBER,
       QT BINARY_DOUBLE,
       QTAVARIA BINARY_DOUBLE,
       
       PRIMARY KEY (CODPROD),
       FOREIGN KEY (CODPROD) REFERENCES TABPRODUTO (CODPROD)
);

CREATE TABLE TABCOBRANCA (
       CODCOB NUMBER PRIMARY KEY,
       DESCRICAO VARCHAR(100) NOT NULL
);

CREATE SEQUENCE TABCOBRANCA_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER TK_COBRANCA_CODCOB
BEFORE INSERT ON TABCOBRANCA
FOR EACH ROW
  BEGIN
    IF :NEW.CODCOB IS NULL THEN
      SELECT TABCOBRANCA_SEQ.NEXTVAL INTO :NEW.CODCOB FROM DUAL;
    END IF;   
  END;
/

CREATE TABLE TABPLANOPAG(
       CODPLPAG NUMBER PRIMARY KEY,
       CODCOB NUMBER NOT NULL,
       DESCRICAO VARCHAR(100) NOT NULL,
       VALOR_MINIMO BINARY_DOUBLE,
       
       CONSTRAINT FK_CODCOB FOREIGN KEY (CODCOB) REFERENCES TABCOBRANCA(CODCOB)
);

CREATE SEQUENCE TABPLANOPAG_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER TK_PLANOPAG_CODPLPAG
BEFORE INSERT ON TABPLANOPAG
FOR EACH ROW
  BEGIN
    IF :NEW.CODPLPAG IS NULL THEN
      SELECT TABPLANOPAG_SEQ.NEXTVAL INTO :NEW.CODPLPAG FROM DUAL;
    END IF;    
  END;
/


CREATE TABLE TABPEDIDO (
       NUMPED NUMBER PRIMARY KEY,
       VLTOTAL BINARY_DOUBLE DEFAULT NULL,
       CODVENDEDOR NUMBER NOT NULL,
       CODCLI NUMBER NOT NULL,
       POSICAO CHAR(1) CHECK(POSICAO IN ('L', 'B', 'M', 'C')),
       CODCOB NUMBER NOT NULL,
       CODPLPAG NUMBER NOT NULL,
       
       FOREIGN KEY (CODVENDEDOR) REFERENCES TABVENDEDOR(CODVENDEDOR),
       FOREIGN KEY (CODCLI) REFERENCES TABCLIENTE(CODCLI),
       FOREIGN KEY (CODCOB) REFERENCES TABCOBRANCA(CODCOB),
       CONSTRAINT FK_CODPLPAG FOREIGN KEY (CODPLPAG) REFERENCES TABPLANOPAG(CODPLPAG)
);

CREATE SEQUENCE TABPEDIDO_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER TK_PEDIDO_NUMPED
BEFORE INSERT ON TABPEDIDO
FOR EACH ROW 
  BEGIN
    IF :NEW.NUMPED IS NULL THEN
      SELECT TABPEDIDO_SEQ.NEXTVAL INTO :NEW.NUMPED FROM DUAL;
    END IF;    
  END;
/


SELECT * FROM TABCLIENTE;

